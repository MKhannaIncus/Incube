<div class="view container-fluid mt-4">
  <!-- Summary Cards -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="card text-white bg-primary mb-3">
        <div class="card-body">
          <h5 class="card-title">Deal Information</h5>
          <div class="table-responsive">
            <div class="table-responsive">
              <table class="table table-hover w-100">
                <tbody>
                  <tr>
                    <th>Investment Date</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.investment_date | date }}</td>
                  </tr>
                  <tr>
                    <th>Maturity Date</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.maturity_date | date }}</td>
                  </tr>
                  <tr>
                    <th>Facility</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.facility }}</td>
                  </tr>
                  <tr>
                    <th>Opening Fee</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.opening_fee }}</td>
                  </tr>
                  <tr>
                    <th>Availability Fee</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.availability_fee }}</td>
                  </tr>
                  <tr>
                    <th>Minimum Multiple</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.minimum_multiple }}</td>
                  </tr>
                  <tr>
                    <th>IRR</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.IRR }}</td>
                  </tr>
                  <tr>
                    <th>NAV</th>
                    <td *ngFor="let deal of dealInformation">{{ deal.NAV }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card text-white bg-success mb-3">
        <div class="card-body">
          <h5 class="card-title">Facility Information</h5>
          <div class="table-responsive">
            <table class="table table-hover w-100">
              <thead>
                <tr>
                  <th>Facility</th>
                  <th>Undrawn Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ facilityInformation?.facility | number:'1.0-0' }}</td>
                  <td>{{ facilityInformation?.undrawnAmount| number:'1.0-0' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  <!-- Transactions Table -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center bg-dark text-white">
      <div class="d-flex align-items-center">
        <h2 class="mb-0 mr-3 headingPadding">Transactions</h2>
        <button class="btn btn-light text-dark" (click)="togglePopup('repayment')">Repayment</button>
        <button class="btn btn-light text-dark" (click)="togglePopup('disbursement')">Disbursement</button>
      </div>
    </div>
    <div class="table-responsive w-100">
      <table class="table table-hover table-bordered w-100" align="left">
        <thead class="thead-dark">
          <tr>
            <th rowspan="2">Transaction ID</th>
            <th rowspan="2">Related Deal ID</th>
            <th rowspan="2">Transaction Date</th>
            <th colspan="4" class="group-header">BOP</th>
            <th rowspan="2">Undrawn Amount</th>
            <th colspan="3" class="group-header">Accrued</th>
            <th colspan="4" class="group-header">Repayments</th>
            <th rowspan="2">Capitalized</th>
            <th colspan="4" class="group-header">EOP</th>
            <th rowspan="2">Amount Due EOP</th>
          </tr>
          <tr>
            <th>Amount due BOP</th>
            <th>Principal BOP</th>
            <th>Cash Interest BOP</th>
            <th>PIK Interest BOP</th>
            <th>Cash Interest Accrued</th>
            <th>PIK Interest Accrued</th>
            <th>Undrawn Interest Accrued</th>
            <th>Repayment Cash Interest</th>
            <th>Repayment PIK Interest</th>
            <th>Repayment Principal</th>
            <th>Repayment Undrawn Fees</th>
            <th>Principal EOP</th>
            <th>Cash Interest EOP</th>
            <th>PIK Interest EOP</th>
            <th>Undrawn Interest EOP</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let transaction of transactions">
            <td>{{ transaction.transaction_Id }}</td>
            <td>{{ transaction.related_Deal_Id }}</td>
            <td>{{ transaction.transaction_Date | date }}</td>
            <td>{{ transaction.amount_Due_BOP | number:'1.0-0' }}</td>
            <td>{{ transaction.principal_BOP | number:'1.0-0'  }}</td>
            <td>{{ transaction.cash_Interest_BOP }}</td>
            <td>{{ transaction.piK_Interest_BOP }}</td>
            <td>{{ transaction.undrawn_Amount | number:'1.0-0' }}</td>
            <td>{{ transaction.cash_Interest_Accrued | number:'1.0-0' }}</td>
            <td>{{ transaction.piK_Interest_Accrued | number:'1.0-0' }}</td>
            <td>{{ transaction.undrawn_Interest_Accrued | number:'1.0-0' }}</td>
            <td>{{ transaction.repayment_CashInterest| number:'1.0-0'  }}</td>
            <td>{{ transaction.repayment_PIKInterest | number:'1.0-0' }}</td>
            <td>{{ transaction.repayment_Principal | number:'1.0-0' }}</td>
            <td>{{ transaction.repayment_UndrawnFees | number:'1.0-0'  }}</td>
            <td>{{ transaction.capitalized| number:'1.0-0'  }}</td>
            <td>{{ transaction.principal_EOP | number:'1.0-0' }}</td>
            <td>{{ transaction.cash_Interest_EOP | number:'1.0-0' }}</td>
            <td>{{ transaction.piK_Interest_EOP| number:'1.0-0'  }}</td>
            <td>{{ transaction.undrawn_Interest_EOP | number:'1.0-0'  }}</td>
            <td>{{ transaction.amount_Due_EOP| number:'1.0-0'  }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Popup Overlay for adding a new deal -->
<div *ngIf="popup" class="overlay">
  <div class="modal fade show" *ngIf="popup" style="display: block;" aria-hidden="!popup" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" (click)="closePopup()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <ng-container *ngIf="isRepayment">
            <app-repayment></app-repayment>
          </ng-container>
          <ng-container *ngIf="isDisbursement">
            <app-disbursement></app-disbursement>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>
